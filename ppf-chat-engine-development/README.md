# ppf-chat-engine
The PPF chat engine, from scratch
More at [ChatEngineDesign.md](ChatEngineDesign.md)

- [x] Chat engine with single websocket server
- [x] Chat Rooms with multiple users
- [x] API for the chat engine
- [x] Swagger documentation
- [ ] Persistence with SQLite
- [ ] Dockerize the application

## Setup project
- FIXME fix this section to follow a docker setup 
1. [Install Go 1.22](https://go.dev/doc/install)
2. Clone the repository
3. Run the following commands:
```bash
go mod download
swag init -d cmd,api,chat
go build -o build cmd/main.go
go test -v ./test
```

## Directory structure
```
·
├── api                 // Service API endpoints controller
├── architecture.drawio // Architecture diagram
├── chat
│   ├── engine.go       // Main functions for the engine invoked by the API controller
│   ├── server.go       // Server that handles the websocket connections and messages
│   ├── room.go         // Defines the chat room
│   ├── user.go         // Defines a user of the chat engine
│   ├── client.go       // Client defines the ws client that resides in the server
│   ├── message.go      // Message struct for the chat engine
│   ├── repository.go   // Repository pattern interfaces
│   ├── roomRecord.go   // Repository pattern, defines a room record on the database
│   ├── userRecord.go   // Repository pattern, defines a user record on the database
│   ├── sqlite.go       // SQLite implementation for the repository pattern
│   └── error.go        // Error handling for the engine
├── cmd
│   └── main.go         // Main entry point for the application
├── docs                // Autogenerated Swagger documentation
···
```

## API Endpoints

| METHOD | ENDPOINT           | AUTH | DESCRIPTION                                   |
| ------ | ------------------ | ---- | --------------------------------------------- |
| GET    | /connect/<user_id> | USER | Initiates a websocket conn for a certain user |

| GET    | /room/<room_id>/messages | SERVICE | Get the messages of a room                    |


### Authentication
*Header*: `Authorization: Token <token>`
*USER*: Requests must include a valid user token in the header


<!-- zaaaaaaagh D: @AndreaFrutos -->